---
layout: default
title: HTTP API
order: 5
permalink: /docs/api-http/
has_children: false
---

## Client (HTTP)

### Query via http

There are three different ways of executing SQL statement via HTTP.
Those api support not only "SELECT" but also "CREATE TABLE", "ALTER TABLE", "INSERT"... all other SQL statements.

- GET
    - [query-get.go](./client-http-go/query-get.go)
    - curl
        ```sh
        curl -o - http://127.0.0.1:4058/db/query \
            --data-urlencode "q=select * from TAGDATA"
        ```

- POST JSON
    - [query-post-json.go](./client-http-go/query-post-json.go)
    - curl
        ```sh
        curl -o - -X POST http://127.0.0.1:4058/db/query \
            -H 'Content-Type: application/json' \
            -d '{ "q":"select * from TAGDATA" }'
        ```

- POST form data
    - [query-post-form.go](./client-http-go/query-post-form.go)
    - curl
        ```sh
        curl -o - -X POST http://127.0.0.1:4058/db/query \
            --data-urlencode "q=select * from TAGDATA"
        ```



### write via http

Even `query` api can execute 'INSERT' statement, it is not effecient to write data with it,
because client should use static sql text in `q` parameter.
The proper way to write data is using `write` api which is `INSERT` equivalent. Also client application can insert multiple records in single `write` request.

- [write.go](./client-http-go/write.go)
- curl
    ```sh
    curl -o - -X POST http://127.0.0.1:4058/db/write -H "Content-Type: application/json" \
        -d "@post-data.json"
    ```

    - `post-data.json`
    ```json
        {
            "table": "TAGDATA",
            "data": {
                "columns":["name", "time", "value", "jsondata"],
                "rows": [
                    [ "my-car", 1670380342000000000, 1.0001, "{\"speed\":\"32.1kmh\",\"lat\":37.38906,\"lon\":127.12182}" ],
                    [ "my-car", 1670380343000000000, 2.0002, "{\"speed\":\"65.4kmh\",\"lat\":37.38908,\"lon\":127.12189}" ]
                ]
            }
        }
    ```

### write via http lineprotocol

Machbase also provides a compatibility api that accepts influxdata lineprotocol message format to insert data.
This api is convenient way to write data from lineprotocol clients (e.g telegraf)

> Since Machbase has different scheme from influxdb, some translations will be automatically occurred.
    
- Translation

| Machbase            | influxdb                                    |
| ------------------- | ------------------------------------------- |
| table name          | db                                          |
| tag name            | measurement + '.' + field name              |
| time                | timestamp                                   |
| value               | value of the field (if it is not a number type, will be ignored and not inserted) |

- curl
    ```sh
    curl -o - -X POST "http://127.0.0.1:4058/metrics/write?db=tagdata" --data-binary 'my-car speed=87.6 167038034500000'
    ```
    > This example inserts data into table `tagdata` with `name`='my-car.speed', `value`=87.6 and `time`=167038034500000

- telegraf.conf example

    ```
    [[outputs.http]]
    url = "http://127.0.0.1:4058/metrics/write?db=tagdata"
    data_format = "influx"
    content_encoding = "gzip"
    ```
