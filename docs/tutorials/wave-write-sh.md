---
title: Shell script for writing
parent: Wave data and monitoring
grand_parent: Tutorials
layout: default
order: 30
nav_order: 100
---

# Shell script for writing data

The simplest way writing data into machbase-neo is using its command line tool `machbase-neo shell`.
We can import/export/read table with it.

## Step 1. Data generation

For demonstration, we prepares simple shell script that prints out sine/cosine values per a second.

Copy script below and save it as `script_wave.sh`

```sh
#!/bin/bash
angle=0
step_angle=24
sinval=0
cosval=0
PI=3.14159

while [ 1 ]
do
    ts=`date +"%s"`
    sinval=$(awk "BEGIN{ printf \"%.6f\", (sin($angle*($PI/180)))}")
    cosval=$(awk "BEGIN{ printf \"%.6f\", (cos($angle*($PI/180)))}")
    echo "wave.sin,$ts,$sinval"
    echo "wave.cos,$ts,$cosval"
    sleep 1
    angle=$((angle+step_angle))
done
```

## Step 2. Run script 

Let's run this script for testing.

```sh
sh ./script_save.sh
```

It periodically prints sin/cos values with name (`wave.sin`, `wave.cos`), UNIX epoch time and value per a second as below.
The output is in csv and it is intended to utilize `machbase-neo shell` command.

```cs
wave.sin,1674815646,0.000000
wave.cos,1674815646,1.000000
wave.sin,1674815647,0.406736
wave.cos,1674815647,0.913546
wave.sin,1674815648,0.743144
wave.cos,1674815648,0.669131
```

Press `^C` to stop shell script.

Why the output csv should be in this order? It's depends on the table scheme.

Run command below to "describe" a table.

```sh
machbase-neo shell desc EXAMPLE
```

Subcommand `desc <table>` shows some details of the table.

```
TABLE    EXAMPLE
TYPE     Tag Table
TAGS     wave.cos, wave.sin
┌───┬───────┬──────────┬────────┐
│ # │ NAME  │ TYPE     │ LENGTH │
├───┼───────┼──────────┼────────┤
│ 1 │ NAME  │ varchar  │    100 │
│ 2 │ TIME  │ datetime │      8 │
│ 3 │ VALUE │ double   │      8 │
└───┴───────┴──────────┴────────┘
```

When we import csv data into a table, it is important to make fields of csv in order of table's columns and its type.

## Step 3. Combine script and command

Now we can use the output of the script for input of `machbase-neo shell`.

```sh
sh wave.sh | machbase-neo shell import --timeformat=s EXAMPLE
```

{: .note }
> Since machbase-neo treats all timestamp in nanoseconds,
> but shell script generates timestamp in seconds by `time` shell command.
> It is required explicitly announce to machbase-neo 
> that incoming timestamp of csv data
> is in seconds time precision by `--timeformat`

CSV lines that are generated by shell script are being processed in `machbase-neo shell import` then "import" into `EXAMPLE` table.

This means also we can write data manually like below example.

```
echo "wave.pi,1674860125,3.141592" | machbase-neo shell import -t s EXAMPLE
```

or

```
echo "wave.pi,`date +%s`,3.141592" | machbase-neo shell import -t s EXAMPLE
```

Then query the latest value.

```sh
$ machbase-neo shell "select * from EXAMPLE where NAME='wave.pi' order by time desc limit 1"

 #  NAME     TIME(UTC)                   VALUE
──────────────────────────────────────────────────
 1  wave.pi  2023-01-27 23:03:45.000000  3.141592

 ```